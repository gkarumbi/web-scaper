const axios = require('axios');
const cheerio = require('cheerio');
const express = require('express');

const PORT = 8000
const url ='https://www.classcentral.com/'
const app = express()

axios(url)
    .then(response =>{
        const html = response.data
    })



app.listen(PORT,()=>{console.log(`server running on PORT ${PORT}`)})


app.get('/', async (req, res) => {
  try {
    const response = await axios.get('https://www.classcentral.com/subject/data-science');
    const $ = cheerio.load(response.data);
    const courses = [];

    $('.course-list .course-name').each((index, element) => {
      const courseName = $(element).text().trim();
      courses.push(courseName);
    });

    const homepage = response.data;

    res.render('index', { courses, homepage }); // pass homepage to the index.ejs template
  } catch (error) {
    console.error(error);
    res.status(500).send('Internal Server Error');
  }
});


app.get('/', async (req, res) => {
  // fetch the HTML content of the classcentral.com homepage
  const response = await axios.get('https://www.classcentral.com/');
  const html = response.data;

  // extract all anchor tags from the HTML content
  const $ = cheerio.load(html);
  const anchorTags = $('a');

  // Modify the href attribute of each anchor tag to prepend the base URL
for (let i = 0; i < anchorTags.length; i++) {
    const href = anchorTags.eq(i).attr('href');
    if (href && href.startsWith('/')) {
      anchorTags.eq(i).attr('href', `https://www.classcentral.com${href}`);
    }
  }

  // translate the inner text of each anchor tag to Hindi
  const translations = [];
  for (let i = 0; i < anchorTags.length; i++) {
    const innerText = anchorTags.eq(i).text();
    const [translation] = await translate.translate(innerText, 'hi');
    translations.push(translation);
  }   
  
    // replace the href attribute with the full URL, this solve the proble of having the links as localhost:3000/rankings as opposed to https://classcentral.com/rankings

  anchorTags.each((i, el) => {
    const href = $(el).attr('href');
    if (href && href.startsWith('/')) {
      $(el).attr('href', `${BASE_URL}${href}`);
    }
  });


  // render the HTML using EJS
  res.render('index', { anchorTags, translations });
});